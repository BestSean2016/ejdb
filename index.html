<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>EJDB by Softmotions</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">EJDB</h1>
        <p class="header">Embedded JSON Database engine</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/Softmotions/ejdb/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/Softmotions/ejdb/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/Softmotions/ejdb">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/Softmotions">Softmotions</a></p>


      </header>
      <section>
        <h2>
<a name="ejdb-aims-to-be-a-fast-mongodb-like-library-which-can-be-embedded-into-cc-net-nodejs-python-lua-java-ruby-go-applications-under-terms-of-lgpl-license" class="anchor" href="#ejdb-aims-to-be-a-fast-mongodb-like-library-which-can-be-embedded-into-cc-net-nodejs-python-lua-java-ruby-go-applications-under-terms-of-lgpl-license"><span class="octicon octicon-link"></span></a>EJDB aims to be a fast <a href="http://mongodb.org">MongoDB</a>-like library which can be embedded into C/C++, .Net, NodeJS, Python, Lua, Java, Ruby, Go applications under terms of LGPL license.</h2>

<p>EJDB is the C library based on modified version of <a href="http://fallabs.com/tokyocabinet/">Tokyo Cabinet</a>.
JSON representation of queries and data implemented with API based on <a href="https://github.com/mongodb/mongo-c-driver/tree/master/src/">C BSON</a></p>

<h1>
<a name="news" class="anchor" href="#news"><span class="octicon octicon-link"></span></a>News</h1>

<ul>
<li>
<code>2013-09-20</code> <strong><a href="https://github.com/kyamagu/matlab-ejdb">EJDB Matlab binding from Kota Yamaguchi</a></strong>
</li>
<li>
<code>2013-09-10</code> <strong><a href="https://github.com/Softmotions/ejdb/wiki/V1.1.24">v1.1.24 Fixed incorrect $set behaviour</a></strong>
</li>
<li>
<code>2013-08-19</code> <strong><a href="https://github.com/Softmotions/ejdb/wiki/V1.1.19">v1.1.19 Added support the long awaited mongodb update positional operator</a></strong>
</li>
<li>
<code>2013-08-11</code> <strong><a href="https://github.com/Softmotions/ejdb/wiki/V1.1.18">v1.1.18 Added support for mongodb $ projection</a></strong>
</li>
<li>
<code>2013-08-08</code> <strong><a href="https://github.com/Softmotions/ejdb/issues/81">v1.1.17 Now supported $and &amp; $or mongodb operators</a></strong>
</li>
<li>
<code>2013-07-15</code> <strong><a href="https://github.com/mkilling/goejdb">Google Go binding</a></strong>
</li>
<li>
<code>2013-06-23</code> <strong><a href="https://github.com/Softmotions/ejdb-csharp">C# .Net binding</a></strong>
</li>
<li>
<code>2013-06-02</code> <strong><a href="https://github.com/thejustinwalsh/airejdb">Adobe Air Native Extension (ANE) for EJDB (Thanks to @thejustinwalsh)</a></strong>
</li>
<li>
<code>2013-05-29</code> <strong><a href="https://github.com/Softmotions/ejdb-python">EJDB Python 2.7.x binding available</a></strong>
</li>
<li>
<code>2013-05-06</code> <strong><a href="https://github.com/Softmotions/ejdb-ruby">Ruby binding available</a></strong>
</li>
<li>
<code>2013-05-02</code> <strong><a href="https://github.com/Softmotions/ejdb/blob/master/tcejdb/WIN32.md#ejdb-nodejs-module-installation">NodeJS win32 module available</a></strong>
</li>
<li>
<code>2013-04-25</code> <strong><a href="https://github.com/Softmotions/ejdb/blob/master/tcejdb/WIN32.md">EJDB and TokyoCabinet API ported to Windows</a></strong>
</li>
<li>
<code>2013-04-03</code> <strong><a href="https://github.com/Softmotions/ejdb-java">Java API binding available</a></strong>
</li>
<li>
<code>2013-03-20</code> <strong><a href="https://github.com/Softmotions/ejdb-lua/">Lua binding available</a></strong>
</li>
<li>
<code>2013-02-15</code> <strong><a href="https://github.com/Softmotions/ejdb-python">EJDB Python3 binding available</a></strong>
</li>
<li>
<code>2013-02-07</code> <strong><a href="https://github.com/Softmotions/ejdb/wiki/Debian-Ubuntu-installation">Debian packages provided</a></strong>
</li>
<li>
<code>2013-01-22</code> <strong><a href="https://github.com/Softmotions/ejdb/wiki/Collection-joins">Collection joins now supported</a></strong>
</li>
</ul><h1>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h1>

<ul>
<li>LGPL license allows you to embed this library into proprietary software.</li>
<li><a href="https://github.com/Softmotions/ejdb/blob/master/tcejdb/WIN32.md">EJDB and TokyoCabinet API ported to Windows</a></li>
<li>MongoDB-like queries and overall philosophy.</li>
<li><a href="https://github.com/Softmotions/ejdb/wiki/Collection-joins">Collection joins</a></li>
<li>Collection level write locking.</li>
<li>Collection level transactions.</li>
<li>Node.js/Python/Lua/Java/Ruby/.Net/Go bindings</li>
<li><a href="https://github.com/thejustinwalsh/airejdb">Adobe Air Native Extension (ANE) for EJDB</a></li>
<li><a href="https://github.com/hww3/pike_modules-ejdb">Pike language binding</a></li>
</ul><h1>
<a name="documentation" class="anchor" href="#documentation"><span class="octicon octicon-link"></span></a>Documentation</h1>

<ul>
<li><strong><a href="http://blog.abigopal.com/post/51616277039/ejdb">The brief intro to the EJDB</a></strong></li>
<li><strong><a href="https://github.com/Softmotions/ejdb/wiki/EJDB-Command-line-interface">EJDB Command line interface</a></strong></li>
<li>
<strong><a href="#ejdb-c-library">EJDB C Library</a></strong>

<ul>
<li><a href="#building--installation">Building &amp; Installation</a></li>
<li><a href="#ejdb-c-samples">Samples</a></li>
<li><a href="#c-api">C API</a></li>
</ul>
</li>
<li><strong><a href="https://github.com/Softmotions/ejdb/wiki/Data-Import-Export">Data Import/Export</a></strong></li>
<li><strong><a href="https://github.com/Softmotions/ejdb/wiki/Collection-joins">Collection joins</a></strong></li>
<li><strong><a href="https://github.com/Softmotions/ejdb/wiki/Development-FAQ">Development FAQ</a></strong></li>
<li>
<strong>Bindings</strong>

<ul>
<li><strong><a href="https://github.com/Softmotions/ejdb-csharp">C# .Net</a></strong></li>
<li><strong><a href="https://github.com/Softmotions/ejdb-node">NodeJS</a></strong></li>
<li><strong><a href="https://github.com/Softmotions/ejdb-python">Python 2.7/3.x</a></strong></li>
<li><strong><a href="https://github.com/Softmotions/ejdb-lua/">Lua</a></strong></li>
<li><strong><a href="https://github.com/Softmotions/ejdb-java">Java</a></strong></li>
<li><strong><a href="https://github.com/Softmotions/ejdb-ruby">Ruby</a></strong></li>
<li><strong><a href="https://github.com/johnnyd/EJDBKit">Objective-C</a></strong></li>
<li><strong><a href="https://github.com/mkilling/goejdb/">Go</a></strong></li>
<li><strong><a href="https://github.com/hww3/pike_modules-ejdb">Pike language</a></strong></li>
<li><strong><a href="https://github.com/thejustinwalsh/airejdb">Adobe Air</a></strong></li>
<li>
<strong>[Matlab]</strong> (<a href="https://github.com/kyamagu/matlab-ejdb">https://github.com/kyamagu/matlab-ejdb</a>)</li>
</ul>
</li>
</ul><h1>
<a name="community" class="anchor" href="#community"><span class="octicon octicon-link"></span></a>Community</h1>

<ul>
<li><strong><a href="https://twitter.com/ejdblab">ejdblab@twitter.com</a></strong></li>
<li><strong>We use <a href="http://groups.google.com/group/ejdb">EJDB Google group</a> as our mailing list.</strong></li>
<li><a href="https://github.com/Softmotions/ejdb/wiki/Projects-using-EJDB">Projects using EJDB</a></li>
</ul><h1>
<a name="ejdb-nodejs" class="anchor" href="#ejdb-nodejs"><span class="octicon octicon-link"></span></a>EJDB NodeJS</h1>

<h2>
<a name="one-snippet-intro" class="anchor" href="#one-snippet-intro"><span class="octicon octicon-link"></span></a>One snippet intro</h2>

<div class="highlight highlight-JavaScript"><pre><span class="kd">var</span> <span class="nx">EJDB</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"ejdb"</span><span class="p">);</span>
<span class="c1">//Open zoo DB</span>
<span class="kd">var</span> <span class="nx">jb</span> <span class="o">=</span> <span class="nx">EJDB</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"zoo"</span><span class="p">,</span> <span class="nx">EJDB</span><span class="p">.</span><span class="nx">DEFAULT_OPEN_MODE</span> <span class="o">|</span> <span class="nx">EJDB</span><span class="p">.</span><span class="nx">JBOTRUNC</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">parrot1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"Grenny"</span><span class="p">,</span>
    <span class="s2">"type"</span> <span class="o">:</span> <span class="s2">"African Grey"</span><span class="p">,</span>
    <span class="s2">"male"</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">"age"</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">"birthdate"</span> <span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
    <span class="s2">"likes"</span> <span class="o">:</span> <span class="p">[</span><span class="s2">"green color"</span><span class="p">,</span> <span class="s2">"night"</span><span class="p">,</span> <span class="s2">"toys"</span><span class="p">],</span>
    <span class="s2">"extra1"</span> <span class="o">:</span> <span class="kc">null</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">parrot2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"Bounty"</span><span class="p">,</span>
    <span class="s2">"type"</span> <span class="o">:</span> <span class="s2">"Cockatoo"</span><span class="p">,</span>
    <span class="s2">"male"</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"age"</span> <span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">"birthdate"</span> <span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
    <span class="s2">"likes"</span> <span class="o">:</span> <span class="p">[</span><span class="s2">"sugar cane"</span><span class="p">]</span>
<span class="p">};</span>

<span class="nx">jb</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="s2">"parrots"</span><span class="p">,</span> <span class="p">[</span><span class="nx">parrot1</span><span class="p">,</span> <span class="nx">parrot2</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">oids</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Grenny OID: "</span> <span class="o">+</span> <span class="nx">parrot1</span><span class="p">[</span><span class="s2">"_id"</span><span class="p">]);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Bounty OID: "</span> <span class="o">+</span> <span class="nx">parrot2</span><span class="p">[</span><span class="s2">"_id"</span><span class="p">]);</span>

    <span class="nx">jb</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">"parrots"</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">"likes"</span> <span class="o">:</span> <span class="s2">"toys"</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">"$orderby"</span> <span class="o">:</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">:</span> <span class="mi">1</span><span class="p">}},</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">cursor</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Found "</span> <span class="o">+</span> <span class="nx">count</span> <span class="o">+</span> <span class="s2">" parrots"</span><span class="p">);</span>
                <span class="k">while</span> <span class="p">(</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">next</span><span class="p">())</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">field</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" likes toys!"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">cursor</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span> <span class="c1">//It's not mandatory to close cursor explicitly</span>
                <span class="nx">jb</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span> <span class="c1">//Close the database</span>
            <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><strong><a href="https://github.com/Softmotions/ejdb-node">EJDB NodeJS binding page</a></strong></p>

<h1>
<a name="ejdb-python" class="anchor" href="#ejdb-python"><span class="octicon octicon-link"></span></a>EJDB Python</h1>

<h2>
<a name="one-snippet-intro-1" class="anchor" href="#one-snippet-intro-1"><span class="octicon octicon-link"></span></a>One snippet intro</h2>

<div class="highlight highlight-python"><pre><span class="kn">import</span> <span class="nn">pyejdb</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c">#Open database</span>
<span class="n">ejdb</span> <span class="o">=</span> <span class="n">pyejdb</span><span class="o">.</span><span class="n">EJDB</span><span class="p">(</span><span class="s">"zoo"</span><span class="p">,</span> <span class="n">pyejdb</span><span class="o">.</span><span class="n">DEFAULT_OPEN_MODE</span> <span class="o">|</span> <span class="n">pyejdb</span><span class="o">.</span><span class="n">JBOTRUNC</span><span class="p">)</span>

<span class="n">parrot1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"Grenny"</span><span class="p">,</span>
    <span class="s">"type"</span><span class="p">:</span> <span class="s">"African Grey"</span><span class="p">,</span>
    <span class="s">"male"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="s">"age"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"birthdate"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
    <span class="s">"likes"</span><span class="p">:</span> <span class="p">[</span><span class="s">"green color"</span><span class="p">,</span> <span class="s">"night"</span><span class="p">,</span> <span class="s">"toys"</span><span class="p">],</span>
    <span class="s">"extra1"</span><span class="p">:</span> <span class="bp">None</span>
<span class="p">}</span>
<span class="n">parrot2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"Bounty"</span><span class="p">,</span>
    <span class="s">"type"</span><span class="p">:</span> <span class="s">"Cockatoo"</span><span class="p">,</span>
    <span class="s">"male"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s">"age"</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s">"birthdate"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
    <span class="s">"likes"</span><span class="p">:</span> <span class="p">[</span><span class="s">"sugar cane"</span><span class="p">],</span>
    <span class="s">"extra1"</span><span class="p">:</span> <span class="bp">None</span>
<span class="p">}</span>
<span class="n">ejdb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">"parrots2"</span><span class="p">,</span> <span class="n">parrot1</span><span class="p">,</span> <span class="n">parrot2</span><span class="p">)</span>

<span class="k">with</span> <span class="n">ejdb</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">"parrots2"</span><span class="p">,</span> <span class="p">{</span><span class="s">"likes"</span> <span class="p">:</span> <span class="s">"toys"</span><span class="p">},</span>
          <span class="n">hints</span><span class="o">=</span><span class="p">{</span><span class="s">"$orderby"</span> <span class="p">:</span> <span class="p">[(</span><span class="s">"name"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]})</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"found </span><span class="si">%s</span><span class="s"> parrots"</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">cur</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">%s</span><span class="s"> likes toys!"</span> <span class="o">%</span> <span class="n">p</span><span class="p">[</span><span class="s">"name"</span><span class="p">])</span>

<span class="n">ejdb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

<p><strong><a href="https://github.com/Softmotions/ejdb-python">EJDB Python 2.7/3.x binding page</a></strong></p>

<h1>
<a name="ejdb-lua" class="anchor" href="#ejdb-lua"><span class="octicon octicon-link"></span></a>EJDB Lua</h1>

<h2>
<a name="one-snippet-intro-2" class="anchor" href="#one-snippet-intro-2"><span class="octicon octicon-link"></span></a>One snippet intro</h2>

<div class="highlight highlight-lua"><pre><span class="kd">local</span> <span class="n">ejdb</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"</span><span class="s">ejdb"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">inspect</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"</span><span class="s">ejdb.inspect"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">ejdb</span><span class="p">.</span><span class="n">Q</span>

<span class="c1">-- Used modes:</span>
<span class="c1">-- 'r' - read</span>
<span class="c1">-- 'w' - write</span>
<span class="c1">-- 'c' - create db if not exists</span>
<span class="c1">-- 't' - truncate existing db</span>
<span class="kd">local</span> <span class="n">db</span> <span class="o">=</span> <span class="n">ejdb</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"</span><span class="s">zoo"</span><span class="p">,</span> <span class="s2">"</span><span class="s">rwct"</span><span class="p">)</span>

<span class="c1">-- Unordered lua table</span>
<span class="kd">local</span> <span class="n">parrot1</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s2">"</span><span class="s">Grenny"</span><span class="p">,</span>
  <span class="nb">type</span> <span class="o">=</span> <span class="s2">"</span><span class="s">African Grey"</span><span class="p">,</span>
  <span class="n">male</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
  <span class="n">age</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
  <span class="n">birthhdate</span> <span class="o">=</span> <span class="n">ejdb</span><span class="p">.</span><span class="n">toDateNow</span><span class="p">(),</span>
  <span class="n">likes</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"</span><span class="s">green color"</span><span class="p">,</span> <span class="s2">"</span><span class="s">night"</span><span class="p">,</span> <span class="s2">"</span><span class="s">toys"</span> <span class="p">},</span>
  <span class="n">extra1</span> <span class="o">=</span> <span class="n">ejdb</span><span class="p">.</span><span class="n">toNull</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">-- Preserve order of BSON keys</span>
<span class="kd">local</span> <span class="n">parrot2</span> <span class="o">=</span> <span class="n">Q</span><span class="p">();</span>
<span class="n">parrot2</span><span class="p">:</span><span class="n">KV</span><span class="p">(</span><span class="s2">"</span><span class="s">name"</span><span class="p">,</span> <span class="s2">"</span><span class="s">Bounty"</span><span class="p">):</span><span class="n">KV</span><span class="p">(</span><span class="s2">"</span><span class="s">type"</span><span class="p">,</span> <span class="s2">"</span><span class="s">Cockatoo"</span><span class="p">):</span><span class="n">KV</span><span class="p">(</span><span class="s2">"</span><span class="s">male"</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
<span class="n">parrot2</span><span class="p">:</span><span class="n">KV</span><span class="p">(</span><span class="s2">"</span><span class="s">age"</span><span class="p">,</span> <span class="mi">15</span><span class="p">):</span><span class="n">KV</span><span class="p">(</span><span class="s2">"</span><span class="s">birthdate"</span><span class="p">,</span>
  <span class="n">ejdb</span><span class="p">.</span><span class="n">toDate</span><span class="p">({</span> <span class="n">year</span> <span class="o">=</span> <span class="mi">2013</span><span class="p">,</span> <span class="n">month</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">day</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hour</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sec</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">}))</span>
<span class="n">parrot2</span><span class="p">:</span><span class="n">KV</span><span class="p">(</span><span class="s2">"</span><span class="s">likes"</span><span class="p">,</span> <span class="p">{</span> <span class="s2">"</span><span class="s">sugar cane"</span> <span class="p">}):</span><span class="n">KV</span><span class="p">(</span><span class="s2">"</span><span class="s">extra1"</span><span class="p">,</span> <span class="n">ejdb</span><span class="p">.</span><span class="n">toNull</span><span class="p">())</span>

<span class="c1">--IF YOU WANT SOME DATA INSPECTIONS:</span>
<span class="c1">--print(ejdb.print_bson(parrot2:toBSON()))</span>
<span class="c1">--local obj = ejdb.from_bson(parrot2:toBSON())</span>
<span class="c1">--print(inspect(obj));</span>

<span class="n">db</span><span class="p">:</span><span class="n">save</span><span class="p">(</span><span class="s2">"</span><span class="s">parrots2"</span><span class="p">,</span> <span class="n">parrot1</span><span class="p">)</span>
<span class="n">db</span><span class="p">:</span><span class="n">save</span><span class="p">(</span><span class="s2">"</span><span class="s">parrots2"</span><span class="p">,</span> <span class="n">parrot2</span><span class="p">)</span>

<span class="c1">-- Below two equivalent queries:</span>
<span class="c1">-- Q1</span>
<span class="kd">local</span> <span class="n">res</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span>
<span class="n">db</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="s">parrots2"</span><span class="p">,</span> <span class="n">Q</span><span class="p">(</span><span class="s2">"</span><span class="s">likes"</span><span class="p">,</span> <span class="s2">"</span><span class="s">toys"</span><span class="p">):</span><span class="n">OrderBy</span><span class="p">(</span><span class="s2">"</span><span class="s">name asc"</span><span class="p">,</span> <span class="s2">"</span><span class="s">age desc"</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">res</span> <span class="k">do</span> <span class="c1">-- iterate one</span>
  <span class="kd">local</span> <span class="n">ob</span> <span class="o">=</span> <span class="n">res</span><span class="p">:</span><span class="n">object</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="s">"</span> <span class="o">..</span> <span class="n">ob</span><span class="p">[</span><span class="s2">"</span><span class="s">name"</span><span class="p">]</span> <span class="o">..</span> <span class="s2">"</span><span class="s"> likes toys #1"</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">-- Q2</span>
<span class="kd">local</span> <span class="n">res</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span>
<span class="n">db</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="s">parrots2"</span><span class="p">,</span> <span class="n">Q</span><span class="p">():</span><span class="n">F</span><span class="p">(</span><span class="s2">"</span><span class="s">likes"</span><span class="p">):</span><span class="n">Eq</span><span class="p">(</span><span class="s2">"</span><span class="s">toys"</span><span class="p">):</span><span class="n">OrderBy</span><span class="p">({</span> <span class="n">name</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">},</span> <span class="p">{</span> <span class="n">age</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}))</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">res</span> <span class="k">do</span> <span class="c1">-- iterate one</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="s">"</span> <span class="o">..</span> <span class="n">res</span><span class="p">:</span><span class="n">field</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">"</span><span class="s">name"</span><span class="p">)</span> <span class="o">..</span> <span class="s2">"</span><span class="s"> likes toys #2"</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">-- Second way to iterate</span>
<span class="k">for</span> <span class="n">vobj</span><span class="p">,</span> <span class="n">idx</span> <span class="k">in</span> <span class="n">res</span><span class="p">()</span> <span class="k">do</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="s">"</span> <span class="o">..</span> <span class="n">vobj</span><span class="p">[</span><span class="s2">"</span><span class="s">name"</span><span class="p">]</span> <span class="o">..</span> <span class="s2">"</span><span class="s"> likes toys #3"</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">db</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
</pre></div>

<p><strong><a href="https://github.com/Softmotions/ejdb-lua">EJDB Lua binding page</a></strong></p>

<h1>
<a name="ejdb-go" class="anchor" href="#ejdb-go"><span class="octicon octicon-link"></span></a>EJDB Go</h1>

<h2>
<a name="one-snippet-intro-3" class="anchor" href="#one-snippet-intro-3"><span class="octicon octicon-link"></span></a>One snippet intro</h2>

<div class="highlight highlight-go"><pre><span class="kn">package</span> <span class="nx">ejdbtutorial</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"github.com/mkilling/goejdb"</span>
    <span class="s">"labix.org/v2/mgo/bson"</span>
    <span class="s">"os"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Create a new database file and open it</span>
    <span class="nx">jb</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">goejdb</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">"addressbook"</span><span class="p">,</span> <span class="nx">JBOWRITER</span> <span class="p">|</span> <span class="nx">JBOCREAT</span> <span class="p">|</span> <span class="nx">JBOTRUNC</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// Get or create collection 'contacts'</span>
    <span class="nx">coll</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">jb</span><span class="p">.</span><span class="nx">CreateColl</span><span class="p">(</span><span class="s">"contacts"</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>

    <span class="c1">// Insert one record:</span>
    <span class="c1">// JSON: {'name' : 'Bruce', 'phone' : '333-222-333', 'age' : 58}</span>
    <span class="nx">rec</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span><span class="s">"name"</span> <span class="p">:</span> <span class="s">"Bruce"</span><span class="p">,</span> <span class="s">"phone"</span> <span class="p">:</span> <span class="s">"333-222-333"</span><span class="p">,</span> <span class="s">"age"</span> <span class="p">:</span> <span class="mi">58</span><span class="p">}</span>
    <span class="nx">bsrec</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">bson</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">rec</span><span class="p">)</span>
    <span class="nx">coll</span><span class="p">.</span><span class="nx">SaveBson</span><span class="p">(</span><span class="nx">bsrec</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"\nSaved Bruce"</span><span class="p">)</span>

    <span class="c1">// Now execute query</span>
    <span class="nx">res</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">coll</span><span class="p">.</span><span class="nx">Find</span><span class="p">(</span><span class="s">`{"name" : {"$begin" : "Bru"}}`</span><span class="p">)</span> <span class="c1">// Name starts with 'Bru' string</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"\n\nRecords found: %d\n"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">res</span><span class="p">))</span>

    <span class="c1">// Now print the result set records</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">bs</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">res</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">m</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
        <span class="nx">bson</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">bs</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">m</span><span class="p">)</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Close database</span>
    <span class="nx">jb</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>

<p><strong><a href="https://github.com/mkilling/goejdb">EJDB Go binding page</a></strong></p>

<h1>
<a name="ejdb-ruby" class="anchor" href="#ejdb-ruby"><span class="octicon octicon-link"></span></a>EJDB Ruby</h1>

<h2>
<a name="one-snippet-intro-4" class="anchor" href="#one-snippet-intro-4"><span class="octicon octicon-link"></span></a>One snippet intro</h2>

<div class="highlight highlight-Ruby"><pre><span class="nb">require</span> <span class="s2">"rbejdb"</span>

<span class="c1">#Open zoo DB</span>
<span class="n">jb</span> <span class="o">=</span> <span class="no">EJDB</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"zoo"</span><span class="p">,</span> <span class="ss">EJDB</span><span class="p">:</span><span class="ss">:DEFAULT_OPEN_MODE</span> <span class="o">|</span> <span class="ss">EJDB</span><span class="p">:</span><span class="ss">:JBOTRUNC</span><span class="p">)</span>

<span class="n">parrot1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"Grenny"</span><span class="p">,</span>
    <span class="s2">"type"</span> <span class="o">=&gt;</span> <span class="s2">"African Grey"</span><span class="p">,</span>
    <span class="s2">"male"</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
    <span class="s2">"age"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">"birthdate"</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="p">,</span>
    <span class="s2">"likes"</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">"green color"</span><span class="p">,</span> <span class="s2">"night"</span><span class="p">,</span> <span class="s2">"toys"</span><span class="o">]</span><span class="p">,</span>
    <span class="s2">"extra1"</span> <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="p">}</span>
<span class="n">parrot2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"Bounty"</span><span class="p">,</span>
    <span class="s2">"type"</span> <span class="o">=&gt;</span> <span class="s2">"Cockatoo"</span><span class="p">,</span>
    <span class="s2">"male"</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span>
    <span class="s2">"age"</span> <span class="o">=&gt;</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">"birthdate"</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="p">,</span>
    <span class="s2">"likes"</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">"sugar cane"</span><span class="o">]</span><span class="p">,</span>
    <span class="s2">"extra1"</span> <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="p">}</span>

<span class="n">jb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">"parrots"</span><span class="p">,</span> <span class="n">parrot1</span><span class="p">,</span> <span class="n">parrot2</span><span class="p">)</span>
<span class="nb">puts</span> <span class="s2">"Grenny OID: </span><span class="si">#{</span><span class="n">parrot1</span><span class="o">[</span><span class="s2">"_id"</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
<span class="nb">puts</span> <span class="s2">"Bounty OID: </span><span class="si">#{</span><span class="n">parrot2</span><span class="o">[</span><span class="s2">"_id"</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">jb</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"parrots"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"likes"</span> <span class="o">=&gt;</span> <span class="s2">"toys"</span><span class="p">},</span> <span class="p">{</span><span class="s2">"$orderby"</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}})</span>

<span class="nb">puts</span> <span class="s2">"Found </span><span class="si">#{</span><span class="n">results</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2"> parrots"</span>

<span class="n">results</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">res</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">res</span><span class="o">[</span><span class="s1">'name'</span><span class="o">]</span><span class="si">}</span><span class="s2"> likes toys!"</span>
<span class="p">}</span>

<span class="n">results</span><span class="o">.</span><span class="n">close</span> <span class="c1">#It's not mandatory to close cursor explicitly</span>
<span class="n">jb</span><span class="o">.</span><span class="n">close</span> <span class="c1">#Close the database</span>

</pre></div>

<p><strong><a href="https://github.com/Softmotions/ejdb-ruby">EJDB Ruby binding page</a></strong></p>

<h1>
<a name="ejdb-adobe-air" class="anchor" href="#ejdb-adobe-air"><span class="octicon octicon-link"></span></a>EJDB Adobe AIR</h1>

<h2>
<a name="one-snippet-intro-5" class="anchor" href="#one-snippet-intro-5"><span class="octicon octicon-link"></span></a>One snippet intro</h2>

<div class="highlight highlight-as3"><pre><span class="c1">// Open the zoo DB</span>
<span class="kd">var</span> <span class="n">db</span><span class="p">:</span><span class="kt">EJDBDatabase</span> <span class="o">=</span> <span class="n">EJDB</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s2">"zoo"</span><span class="o">,</span> <span class="n">EJDB</span><span class="o">.</span><span class="na">DEFAULT_OPEN_MODE</span> <span class="o">|</span> <span class="n">EJDB</span><span class="o">.</span><span class="na">JBOTRUNC</span><span class="o">)</span> <span class="k">as</span> <span class="n">EJDBDatabase</span><span class="o">;</span>

<span class="kd">var</span> <span class="n">parrot1</span><span class="p">:</span><span class="kt">Object</span> <span class="o">=</span> <span class="o">{</span>
    <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"Grenny"</span><span class="o">,</span>
    <span class="s2">"type"</span> <span class="o">:</span> <span class="s2">"African Grey"</span><span class="o">,</span>
    <span class="s2">"male"</span> <span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
    <span class="s2">"age"</span> <span class="o">:</span> <span class="mi">1</span><span class="o">,</span>
    <span class="s2">"birthdate"</span> <span class="o">:</span> <span class="k">new</span> <span class="kt">Date</span><span class="o">(),</span>
    <span class="s2">"likes"</span> <span class="o">:</span> <span class="o">[</span><span class="s2">"green color"</span><span class="o">,</span> <span class="s2">"night"</span><span class="o">,</span> <span class="s2">"toys"</span><span class="o">],</span>
    <span class="s2">"extra1"</span> <span class="o">:</span> <span class="kc">null</span>
<span class="o">};</span>
<span class="kd">var</span> <span class="n">parrot2</span><span class="p">:</span><span class="kt">Object</span> <span class="o">=</span> <span class="o">{</span>
    <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"Bounty"</span><span class="o">,</span>
    <span class="s2">"type"</span> <span class="o">:</span> <span class="s2">"Cockatoo"</span><span class="o">,</span>
    <span class="s2">"male"</span> <span class="o">:</span> <span class="kc">false</span><span class="o">,</span>
    <span class="s2">"age"</span> <span class="o">:</span> <span class="mi">15</span><span class="o">,</span>
    <span class="s2">"birthdate"</span> <span class="o">:</span> <span class="k">new</span> <span class="kt">Date</span><span class="o">(),</span>
    <span class="s2">"likes"</span> <span class="o">:</span> <span class="o">[</span><span class="s2">"sugar cane"</span><span class="o">]</span>
<span class="o">};</span>

<span class="kd">var</span> <span class="n">oids</span><span class="p">:</span><span class="kt">Array</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s2">"parrots"</span><span class="o">,</span> <span class="o">[</span><span class="n">parrot1</span><span class="o">,</span> <span class="n">parrot2</span><span class="o">]);</span>
<span class="nf">trace</span><span class="o">(</span><span class="s2">"Grenny OID: "</span> <span class="o">+</span> <span class="n">parrot1</span><span class="o">.</span><span class="na">_id</span><span class="o">);</span>
<span class="nf">trace</span><span class="o">(</span><span class="s2">"Bounty OID: "</span> <span class="o">+</span> <span class="n">parrot2</span><span class="o">.</span><span class="na">_id</span><span class="o">);</span>

<span class="kd">var</span> <span class="n">cursor</span><span class="p">:</span><span class="kt">EJDBCursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="s2">"parrots"</span><span class="o">,</span>
    <span class="o">{</span><span class="s2">"likes"</span> <span class="o">:</span> <span class="s2">"toys"</span><span class="o">},</span>
    <span class="o">[],</span>
    <span class="o">{</span><span class="s2">"$orderby"</span> <span class="o">:</span> <span class="o">{</span><span class="s2">"name"</span> <span class="o">:</span> <span class="mi">1</span><span class="o">}}</span>
<span class="o">);</span>

<span class="nf">trace</span><span class="o">(</span><span class="s2">"Found "</span> <span class="o">+</span> <span class="n">cursor</span><span class="o">.</span><span class="na">length</span> <span class="o">+</span> <span class="s2">" parrots"</span><span class="o">);</span>
<span class="k">while</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
    <span class="nf">trace</span><span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">field</span><span class="o">(</span><span class="s2">"name"</span><span class="o">)</span> <span class="o">+</span> <span class="s2">" likes toys!"</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">cursor</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">// It IS mandatory to close cursor explicitly to free up resources</span>
<span class="n">db</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">// Close the database</span>
</pre></div>

<p><strong><a href="https://github.com/thejustinwalsh/airejdb">Adobe Air Native Extension (ANE) for EJDB</a></strong></p>

<h1>
<a name="ejdb-c-library" class="anchor" href="#ejdb-c-library"><span class="octicon octicon-link"></span></a>EJDB C Library</h1>

<h2>
<a name="one-snippet-intro-6" class="anchor" href="#one-snippet-intro-6"><span class="octicon octicon-link"></span></a>One snippet intro</h2>

<div class="highlight highlight-C"><pre><span class="cp">#include &lt;tcejdb/ejdb.h&gt;</span>

<span class="k">static</span> <span class="n">EJDB</span> <span class="o">*</span><span class="n">jb</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">jb</span> <span class="o">=</span> <span class="n">ejdbnew</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ejdbopen</span><span class="p">(</span><span class="n">jb</span><span class="p">,</span> <span class="s">"addressbook"</span><span class="p">,</span> <span class="n">JBOWRITER</span> <span class="o">|</span> <span class="n">JBOCREAT</span> <span class="o">|</span> <span class="n">JBOTRUNC</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//Get or create collection 'contacts'</span>
    <span class="n">EJCOLL</span> <span class="o">*</span><span class="n">coll</span> <span class="o">=</span> <span class="n">ejdbcreatecoll</span><span class="p">(</span><span class="n">jb</span><span class="p">,</span> <span class="s">"contacts"</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">bson</span> <span class="n">bsrec</span><span class="p">;</span>
    <span class="kt">bson_oid_t</span> <span class="n">oid</span><span class="p">;</span>

    <span class="c1">//Insert one record:</span>
    <span class="c1">//JSON: {'name' : 'Bruce', 'phone' : '333-222-333', 'age' : 58}</span>
    <span class="n">bson_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bsrec</span><span class="p">);</span>
    <span class="n">bson_append_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bsrec</span><span class="p">,</span> <span class="s">"name"</span><span class="p">,</span> <span class="s">"Bruce"</span><span class="p">);</span>
    <span class="n">bson_append_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bsrec</span><span class="p">,</span> <span class="s">"phone"</span><span class="p">,</span> <span class="s">"333-222-333"</span><span class="p">);</span>
    <span class="n">bson_append_int</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bsrec</span><span class="p">,</span> <span class="s">"age"</span><span class="p">,</span> <span class="mi">58</span><span class="p">);</span>
    <span class="n">bson_finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bsrec</span><span class="p">);</span>
    <span class="c1">//Save BSON</span>
    <span class="n">ejdbsavebson</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bsrec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">);</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">Saved Bruce"</span><span class="p">);</span>
    <span class="n">bson_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bsrec</span><span class="p">);</span>

    <span class="c1">//Now execute query</span>
    <span class="c1">//QUERY: {'name' : {'$begin' : 'Bru'}} //Name starts with 'Bru' string</span>
    <span class="n">bson</span> <span class="n">bq1</span><span class="p">;</span>
    <span class="n">bson_init_as_query</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bq1</span><span class="p">);</span>
    <span class="n">bson_append_start_object</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bq1</span><span class="p">,</span> <span class="s">"name"</span><span class="p">);</span>
    <span class="n">bson_append_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bq1</span><span class="p">,</span> <span class="s">"$begin"</span><span class="p">,</span> <span class="s">"Bru"</span><span class="p">);</span>
    <span class="n">bson_append_finish_object</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bq1</span><span class="p">);</span>
    <span class="n">bson_finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bq1</span><span class="p">);</span>

    <span class="n">EJQ</span> <span class="o">*</span><span class="n">q1</span> <span class="o">=</span> <span class="n">ejdbcreatequery</span><span class="p">(</span><span class="n">jb</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bq1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="kt">uint32_t</span> <span class="n">count</span><span class="p">;</span>
    <span class="n">TCLIST</span> <span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="n">ejdbqryexecute</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">count</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">Records found: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>

    <span class="c1">//Now print the result set records</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">TCLISTNUM</span><span class="p">(</span><span class="n">res</span><span class="p">);</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">void</span> <span class="o">*</span><span class="n">bsdata</span> <span class="o">=</span> <span class="n">TCLISTVALPTR</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">bson_print_raw</span><span class="p">(</span><span class="n">bsdata</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="c1">//Dispose result set</span>
    <span class="n">tclistdel</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>

    <span class="c1">//Dispose query</span>
    <span class="n">ejdbquerydel</span><span class="p">(</span><span class="n">q1</span><span class="p">);</span>
    <span class="n">bson_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bq1</span><span class="p">);</span>

    <span class="c1">//Close database</span>
    <span class="n">ejdbclose</span><span class="p">(</span><span class="n">jb</span><span class="p">);</span>
    <span class="n">ejdbdel</span><span class="p">(</span><span class="n">jb</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>You can save this code in <code>csnippet.c</code> And build:</p>

<div class="highlight highlight-sh"><pre>gcc -std<span class="o">=</span>c99 -Wall -pedantic  -c -o csnippet.o csnippet.c
gcc -o csnippet csnippet.o -ltcejdb
</pre></div>

<h2>
<a name="building--installation" class="anchor" href="#building--installation"><span class="octicon octicon-link"></span></a>Building &amp; Installation</h2>

<ul>
<li><a href="https://github.com/Softmotions/ejdb/blob/master/tcejdb/WIN32.md">Installation on windows</a></li>
<li><a href="https://github.com/Softmotions/ejdb/wiki/Debian-Ubuntu-installation">Installation on Debian/Ubuntu</a></li>
</ul><h2>
<a name="manual-installation" class="anchor" href="#manual-installation"><span class="octicon octicon-link"></span></a>Manual installation</h2>

<h3>
<a name="prerequisites" class="anchor" href="#prerequisites"><span class="octicon octicon-link"></span></a>Prerequisites</h3>

<p><strong>System libraries:</strong></p>

<ul>
<li>gcc</li>
<li>zlib-dev</li>
</ul><h3>
<a name="build-and-install" class="anchor" href="#build-and-install"><span class="octicon octicon-link"></span></a>Build and install</h3>

<div class="highlight highlight-sh"><pre>   <span class="nb">cd</span> ./tcejdb
   ./configure --prefix<span class="o">=</span>&lt;installation prefix&gt; <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make check
   make install
</pre></div>

<ul>
<li>library name: <strong>tcejdb</strong> (with pkgconfig)</li>
<li>main include header: <code>&lt;tcejdb/ejdb.h&gt;</code>
</li>
</ul><h2>
<a name="c-api" class="anchor" href="#c-api"><span class="octicon octicon-link"></span></a>C API</h2>

<p>EJDB API presented in <strong><a href="https://github.com/Softmotions/ejdb/blob/master/tcejdb/ejdb.h">ejdb.h</a></strong> C header file.</p>

<p>JSON processing API: <strong><a href="https://github.com/Softmotions/ejdb/blob/master/tcejdb/bson.h">bson.h</a></strong></p>

<h2>
<a name="queries" class="anchor" href="#queries"><span class="octicon octicon-link"></span></a>Queries</h2>

<pre><code>/**
 * Create query object.
 * Sucessfully created queries must be destroyed with ejdbquerydel().
 *
 * EJDB queries inspired by MongoDB (mongodb.org) and follows same philosophy.
 *
 *  - Supported queries:
 *      - Simple matching of String OR Number OR Array value:
 *          -   {'fpath' : 'val', ...}
 *      - $not Negate operation.
 *          -   {'fpath' : {'$not' : val}} //Field not equal to val
 *          -   {'fpath' : {'$not' : {'$begin' : prefix}}} //Field not begins with val
 *      - $begin String starts with prefix
 *          -   {'fpath' : {'$begin' : prefix}}
 *      - $gt, $gte (&gt;, &gt;=) and $lt, $lte for number types:
 *          -   {'fpath' : {'$gt' : number}, ...}
 *      - $bt Between for number types:
 *          -   {'fpath' : {'$bt' : [num1, num2]}}
 *      - $in String OR Number OR Array val matches to value in specified array:
 *          -   {'fpath' : {'$in' : [val1, val2, val3]}}
 *      - $nin - Not IN
 *      - $strand String tokens OR String array val matches all tokens in specified array:
 *          -   {'fpath' : {'$strand' : [val1, val2, val3]}}
 *      - $stror String tokens OR String array val matches any token in specified array:
 *          -   {'fpath' : {'$stror' : [val1, val2, val3]}}
 *      - $exists Field existence matching:
 *          -   {'fpath' : {'$exists' : true|false}}
 *      - $icase Case insensitive string matching:
 *          -    {'fpath' : {'$icase' : 'val1'}} //icase matching
 *          Ignore case matching with '$in' operation:
 *          -    {'name' : {'$icase' : {'$in' : ['tHéâtre - театр', 'heLLo WorlD']}}}
 *          For case insensitive matching you can create special index of type: `JBIDXISTR`
 *     - $elemMatch The $elemMatch operator matches more than one component within an array element.
 *          -  { array: { $elemMatch: { value1 : 1, value2 : { $gt: 1 } } } }
 *          Restriction: only one $elemMatch allowed in context of one array field.
 *      - $and, $or joining:
 *          -   {..., $and : [subq1, subq2, ...] }
 *          -   {..., $or  : [subq1, subq2, ...] }
 *          Example: {z : 33, $and : [ {$or : [{a : 1}, {b : 2}]}, {$or : [{c : 5}, {d : 7}]} ] }
 *
 *      - Mongodb $(projection) operator supported. (http://docs.mongodb.org/manual/reference/projection/positional/#proj._S_)
 *      - Mongodb positional $ update operator supported. (http://docs.mongodb.org/manual/reference/operator/positional/)
 *
 *
 *  - Queries can be used to update records:
 *       $set Field set operation.
 *           - {.., '$set' : {'field1' : val1, 'fieldN' : valN}}
 *       $upsert Atomic upsert. If matching records are found it will be '$set' operation,
 *              otherwise new record will be inserted with fields specified by argment object.
 *           - {.., '$upsert' : {'field1' : val1, 'fieldN' : valN}}
 *       $inc Increment operation. Only number types are supported.
 *           - {.., '$inc' : {'field1' : number, ...,  'field1' : number}
 *       $dropall In-place record removal operation.
 *           - {.., '$dropall' : true}
 *       $addToSet Atomically adds value to the array only if its not in the array already.
 *                    If containing array is missing it will be created.
 *           - {.., '$addToSet' : {'fpath' : val1, 'fpathN' : valN, ...}}
 *       $addToSetAll Batch version if $addToSet
 *           - {.., '$addToSetAll' : {'fpath' : [array of values to add], ...}}
 *       $pull Atomically removes all occurrences of value from field, if field is an array.
 *           - {.., '$pull' : {'fpath' : val1, 'fpathN' : valN, ...}}
 *       $pullAll Batch version of $pull
 *           - {.., '$pullAll' : {'fpath' : [array of values to remove], ...}}
 *
 *  NOTE: Negate operations: $not and $nin not using indexes
 *  so they can be slow in comparison to other matching operations.
 *
 *  NOTE: Only one index can be used in search query operation.
 *
 *  QUERY HINTS (specified by `hints` argument):
 *      - $max Maximum number in the result set
 *      - $skip Number of skipped results in the result set
 *      - $orderby Sorting order of query fields.
 *      - $fields Set subset of fetched fields
            If a field presented in $orderby clause it will be forced to include in resulting records.
 *          Example:
 *          hints:    {
 *                      "$orderby" : { //ORDER BY field1 ASC, field2 DESC
 *                          "field1" : 1,
 *                          "field2" : -1
 *                      },
 *                      "$fields" : { //SELECT ONLY {_id, field1, field2}
 *                          "field1" : 1,
 *                          "field2" : 1
 *                      }
 *                    }
 *
 * Many query examples can be found in `testejdb/t2.c` test case.
 *
 * @param EJDB database handle.
 * @param qobj Main BSON query object.
 * @param orqobjs Array of additional OR query objects (joined with OR predicate).
 * @param orqobjsnum Number of OR query objects.
 * @param hints BSON object with query hints.
 * @return On success return query handle. On error returns NULL.
 */
EJDB_EXPORT EJQ* ejdbcreatequery(EJDB *jb, bson *qobj, bson *orqobjs, int orqobjsnum, bson *hints);
</code></pre>

<h2>
<a name="ejdb-c-samples" class="anchor" href="#ejdb-c-samples"><span class="octicon octicon-link"></span></a>EJDB C Samples</h2>

<p>You can find some code samples in:</p>

<ul>
<li><a href="https://github.com/Softmotions/ejdb/tree/master/tcejdb/samples">tcejdb/samples</a></li>
<li><a href="https://github.com/Softmotions/ejdb/tree/master/tcejdb/testejdb">tcejdb/testejdb</a></li>
</ul><h2>
<a name="basic-ejdb-architecture" class="anchor" href="#basic-ejdb-architecture"><span class="octicon octicon-link"></span></a>Basic EJDB architecture</h2>

<p><strong>EJDB database files structure</strong></p>

<pre><code>.
├── &lt;dbname&gt;
├── &lt;dbname&gt;_&lt;collection1&gt;
├── ...
├── &lt;dbname&gt;_&lt;collectionN&gt;
└── &lt;dbname&gt;_&lt;collectionN&gt;_&lt;fieldpath&gt;.&lt;index ext&gt;
</code></pre>

<p>Where</p>

<ul>
<li>
<code>&lt;dbname&gt;</code> - name of database. It is metadata DB.</li>
<li>
<code>&lt;collectionN&gt;</code> - name of collection. Collection database.</li>
<li>
<code>&lt;fieldpath&gt;</code> - JSON field path used in index</li>
<li>
<code>&lt;index ext&gt;</code> - Collection index extension:

<ul>
<li>
<code>.lex</code> String index</li>
<li>
<code>.dec</code> Number index</li>
<li>
<code>.tok</code> Array index</li>
</ul>
</li>
</ul><h2>
<a name="limitations" class="anchor" href="#limitations"><span class="octicon octicon-link"></span></a>Limitations</h2>

<ul>
<li>One ejdb database can handle up to 1024 collections.</li>
<li>Indexes for objects in nested arrays currently not supported (#37)</li>
</ul><h2>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>TODO</h2>

<ul>
<li>Collect collection index statistic</li>
</ul>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		          <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-36241306-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>